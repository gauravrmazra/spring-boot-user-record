<!DOCTYPE html>
<html ng-app="userModule">
<head>
<meta charset="ISO-8859-1">
<title>All Users</title>
<script type="text/javascript"
	src="WEB_INF/bower_components/angular/angular.min.js"></script>
<script type="text/javascript"
	src="WEB_INF/bower_components/angular-animate/angular-animate.min.js"></script>
<script type="text/javascript"
	src="WEB_INF/bower_components/angular-mocks/angular-mocks.js"></script>
<script type="text/javascript"
	src="WEB_INF/bower_components/angular-resource/angular-resource.min.js"></script>
<script type="text/javascript"
	src="WEB_INF/bower_components/angular-route/angular-route.min.js"></script>
<script type="text/javascript"
	src="WEB_INF/bower_components/jquery/dist/jquery.min.js"></script>
<link type="text/css"
	href="WEB_INF/bower_components/bootstrap/dist/css/bootstrap.css"></link>
<link type="text/css"
	href="WEB_INF/bower_components/bootstrap/dist/css/bootstrap-theme.css"></link>
	<script type="text/javascript">
		var userModule = angular.module('userModule', []);
		userModule.service('LocalUserService', function() {
			var users = [{
								"id" : "292cab5c-0462-455d-9bcc-c8eb8a0d3d41",
								"firstName" : "Gaurav Mahilpuria",
								"lastName" : "Mazra saab"
							}, {
								"id" : "292cab5c-0462-455d-9bcc-c8eb8a0d3d38",
								"firstName" : "Gaurav Mahilpuria3",
								"lastName" : "Mazra saab123"
							}, {
								"id" : "292cab5c-0462-455d-9bcc-c8eb8a0d3d39",
								"firstName" : "Gaurav Mahilpuria3",
								"lastName" : "Mazra saab123"
							}];
			
			
			this.findAll = function() {
				return users;
			}
			
			this.findById = function(id) {
				for (i in users) {
					if (users[i].id === id)
						return users[i];
				}
				return null;
			}
			
			this.remove = function(user) {
				var u;
				for ( var i = 0; i < users.length; i++) {
					u = users[i];
					if (u.id === user.id)
					{
						users.splice(i, 1);
						break;
					}
				}
			}
			
			this.update = function(user) {
				var u;
				for ( var i = 0; i < users.length; i++) {
					u = users[i];
					if (u.id === user.id)
					{
						users[i] = user;
						break;
					}
				}
			}
    
			this.save = function(user) {
				users[users.length] = user;
			}
		});
 
		userModule.controller('UserController', ['$scope', 'LocalUserService',  function($scope, LocalUserService) {
			$scope.users = LocalUserService.findAll();
			$scope.newUser = {};
			$scope.showAllUsers = true;
			var randomUid = 1;
			$scope.deleteUser = function(userId) {
				var user = LocalUserService.findById(userId);
				if (user == null) {
					alert('Exception occured!!! Unable to delete...');
					return;
				}
				LocalUserService.remove(user);
				
				$scope.users = LocalUserService.findAll();
			}
			
			$scope.updateUser = function(u) {
				var user = LocalUserService.findById(u.id);
				if (user == null) {
					alert('Exception occured!!! Unable to update');
					return;
				}
				LocalUserService.update(user);
			}
			
			$scope.saveUser = function(user) {
				++randomUid;
				user.id = randomUid + "";
				LocalUserService.save(user);
			}
			
			$scope.saveOrUpdateUser = function() {
				var u = $scope.newUser;
				
				if (u.id == null || typeof u.id == 'undefined' || u.id == '') {
					$scope.saveUser(u);
				}
				else
					$scope.updateUser(u);
					
				$scope.showAllUsers = true;
			}
			
			$scope.editUser = function(userId) {
				var user = LocalUserService.findById(userId);
				
				if (user == null) {
					alert('Exception occoured. couldnt process edit...');
					return;
				}
				$scope.newUser = user;
				$scope.showAllUsers = false;
			}
			
			$scope.createUser = function() {
				$scope.newUser = {};
				$scope.showAllUsers = false;
			}
			
			$scope.cancelAction = function() {
				$scope.newUser = {};
				$scope.showAllUsers = true;
			}
		}]);
	</script>
</head>
<body>
		<div class="container" ng-controller="UserController">
			<div class="row addUser">
				<div class="col-md-12">
					<button ng-click="createUser()">Create New User</button>
				</div>
			</div>
			
			<div class="container createOrUpdateNewUser" ng-show="!showAllUsers">
				<div class="row">
					<div class="col-md-3">
						First Name
					</div>
					<div class="col-md-9">
						<input type="text" ng-model="newUser.firstName">
					</div>
				</div>
				<div class="row">
					<div class="col-md-3">
						Last Name
					</div>
					<div class="col-md-9">
						<input type="text" ng-model="newUser.lastName">
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<button ng-click="saveOrUpdateUser()">Create/Update</button>&nbsp;&nbsp;&nbsp;
						<button ng-click="cancelAction()">Cancel</button>
					</div>
				</div>
				
			</div>
			
			<div class="row showAllUsers" ng-show="showAllUsers">
				<div class="col-span-12">
					<table class="table table-striped">
						<thead>
							<tr>
								<th>First Name</th>
								<th>Last Name</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="user in users">
								<td>{{user.firstName}}</td>
								<td>{{user.lastName}}</td>
								<td><button ng-click="editUser(user.id);">Edit</button>&nbsp;&nbsp;&nbsp;<button ng-click="deleteUser(user.id);">Delete</button></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>			
		</div>
</body>
</html>